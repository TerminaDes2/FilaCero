generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model roles {
  id_rol     BigInt     @id @default(autoincrement()) @map("id_rol")
  nombre_rol String     @unique @map("nombre_rol") @db.VarChar(50)
  usuarios   usuarios[]

  @@map("roles")
}

model usuarios {
  id_usuario         BigInt       @id @default(autoincrement()) @map("id_usuario")
  id_rol             BigInt?      @map("id_rol")
  nombre             String       @map("nombre") @db.VarChar(150)
  correo_electronico String       @unique @map("correo_electronico") @db.VarChar(254)
  password_hash      String       @map("password_hash") @db.VarChar(255)
  numero_telefono    String?      @map("numero_telefono") @db.VarChar(30)
  fecha_nacimiento   DateTime?    @map("fecha_nacimiento") @db.Date
  fecha_registro     DateTime?    @map("fecha_registro") @db.Timestamptz(6)
  estado             String?      @map("estado") @db.VarChar(20)
  comentario         comentario[]
  corte_caja         corte_caja[]
  feedback           feedback[]
  role               roles?       @relation(fields: [id_rol], references: [id_rol], onDelete: NoAction, onUpdate: NoAction)
  venta              venta[]

  @@map("usuarios")
}

model categoria {
  id_categoria BigInt     @id @default(autoincrement())
  nombre       String     @unique @db.VarChar(120)
  producto     producto[]
}

model comentario {
  id_comentario BigInt     @id @default(autoincrement())
  id_usuario    BigInt?
  comentario    String?
  fecha         DateTime?  @db.Timestamptz(6)
  usuarios      usuarios?  @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
  feedback      feedback[]
}

model corte_caja {
  id_corte       BigInt    @id @default(autoincrement())
  id_negocio     BigInt?
  id_usuario     BigInt?
  fecha_inicio   DateTime? @db.Timestamptz(6)
  fecha_fin      DateTime? @db.Timestamptz(6)
  monto_inicial  Decimal?  @db.Decimal(14, 2)
  monto_final    Decimal?  @db.Decimal(14, 2)
  ventas_totales Int?
  negocio        negocio?  @relation(fields: [id_negocio], references: [id_negocio], onDelete: NoAction, onUpdate: NoAction)
  usuarios       usuarios? @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
}

model detalle_venta {
  id_detalle      BigInt    @id @default(autoincrement())
  id_venta        BigInt?
  id_producto     BigInt?
  cantidad        Int?
  precio_unitario Decimal?  @db.Decimal(12, 2)
  producto        producto? @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
  venta           venta?    @relation(fields: [id_venta], references: [id_venta], onDelete: NoAction, onUpdate: NoAction)
}

model feedback {
  id_feedback   BigInt      @id @default(autoincrement())
  id_usuario    BigInt?
  id_comentario BigInt?
  calificacion  Int?        @db.SmallInt
  fecha         DateTime?   @db.Timestamptz(6)
  comentario    comentario? @relation(fields: [id_comentario], references: [id_comentario], onDelete: NoAction, onUpdate: NoAction)
  usuarios      usuarios?   @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
}

model inventario {
  id_inventario       BigInt    @id @default(autoincrement())
  id_negocio          BigInt?
  id_producto         BigInt?
  stock_minimo        Int?
  cantidad_actual     Int?
  fecha_actualizacion DateTime? @db.Timestamptz(6)
  negocio             negocio?  @relation(fields: [id_negocio], references: [id_negocio], onDelete: NoAction, onUpdate: NoAction)
  producto            producto? @relation(fields: [id_producto], references: [id_producto], onDelete: NoAction, onUpdate: NoAction)
}

model negocio {
  id_negocio     BigInt           @id @default(autoincrement())
  nombre         String           @db.VarChar(200)
  direccion      String?
  telefono       String?          @db.VarChar(30)
  correo         String?          @db.VarChar(254)
  logo           String?
  fecha_registro DateTime?        @db.Timestamptz(6)
  corte_caja     corte_caja[]
  inventario     inventario[]
  reporte_ventas reporte_ventas[]
  venta          venta[]
}

model producto {
  id_producto   BigInt          @id @default(autoincrement())
  id_categoria  BigInt?
  nombre        String          @db.VarChar(200)
  descripcion   String?
  codigo_barras String?         @unique @db.VarChar(100)
  precio        Decimal         @db.Decimal(12, 2)
  imagen        String?
  estado        String?         @db.VarChar(30)
  detalle_venta detalle_venta[]
  inventario    inventario[]
  categoria     categoria?      @relation(fields: [id_categoria], references: [id_categoria], onDelete: NoAction, onUpdate: NoAction)
}

model reporte_ventas {
  id_reporte          BigInt    @id @default(autoincrement())
  id_negocio          BigInt?
  fecha               DateTime? @db.Date
  total_ventas        Decimal?  @db.Decimal(14, 2)
  total_productos     Int?
  total_efectivo      Decimal?  @db.Decimal(14, 2)
  total_tarjeta       Decimal?  @db.Decimal(14, 2)
  total_transferencia Decimal?  @db.Decimal(14, 2)
  negocio             negocio?  @relation(fields: [id_negocio], references: [id_negocio], onDelete: NoAction, onUpdate: NoAction)
}

model tipo_pago {
  id_tipo_pago BigInt  @id @default(autoincrement())
  tipo         String  @unique @db.VarChar(50)
  descripcion  String?
  venta        venta[]
}





model venta {
  id_venta      BigInt          @id @default(autoincrement())
  id_negocio    BigInt?
  id_usuario    BigInt?
  fecha_venta   DateTime?       @db.Timestamptz(6)
  total         Decimal?        @db.Decimal(14, 2)
  id_tipo_pago  BigInt?
  estado        String?         @db.VarChar(30)
  detalle_venta detalle_venta[]
  negocio       negocio?        @relation(fields: [id_negocio], references: [id_negocio], onDelete: NoAction, onUpdate: NoAction)
  tipo_pago     tipo_pago?      @relation(fields: [id_tipo_pago], references: [id_tipo_pago], onDelete: NoAction, onUpdate: NoAction)
  usuarios      usuarios?       @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction)
}
